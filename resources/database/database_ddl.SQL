DROP TABLE ACCOUNT CASCADE
;
DROP TABLE ACCOUNT_TYPE CASCADE
;
DROP TABLE ACTION_TYPE CASCADE
;
DROP TABLE ADVANCED_CONFIGURATION CASCADE
;
DROP TABLE BLOCK CASCADE
;
DROP TABLE CATEGORY CASCADE
;
DROP TABLE CATEGORY_PUBLISHER CASCADE
;
DROP TABLE CATEGORY_SUBSCRIPTION CASCADE
;
DROP TABLE CONSUMER CASCADE
;
DROP TABLE CONSUMER_VERIFICATION CASCADE
;
DROP TABLE CONTRACT CASCADE
;
DROP TABLE FAVORITE_FLYER CASCADE
;
DROP TABLE FLYER CASCADE
;
DROP TABLE FLYER_LOG_ENTRY CASCADE
;
DROP TABLE FLYER_STATUS CASCADE
;
DROP TABLE LOCATION CASCADE
;
DROP TABLE PAVILION CASCADE
;
DROP TABLE ROLE_REGISTRATION CASCADE
;
DROP TABLE ROLES CASCADE
;
DROP TABLE STATUS CASCADE
;
DROP TABLE LINK_HASH CASCADE
;
DROP TABLE LINK_ACTION CASCADE
;
DROP TABLE USERS CASCADE
;


CREATE TABLE ACCOUNT ( 
	ID bigint NOT NULL,
	NAME varchar(255) NOT NULL,
	STATUS_ID integer NOT NULL,
	COMPANY_EMAIL varchar(255) NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	MODIFICATION_DATE timestamp NOT NULL,
	COMPANY_ADDRESS varchar(255) NOT NULL,
	BILLING_ADDRESS varchar(255),
	DELIVERY_ADDRESS varchar(255),
	PHONE_NUMBER bigint,
	ACCOUNT_MANAGER varchar(255),
	ACCOUNT_TYPE_ID integer NOT NULL,
	NIT bigint,
	CI bigint
)
;

CREATE TABLE ACCOUNT_TYPE ( 
	ID integer NOT NULL,
	NAME varchar(255) NOT NULL
)
;

CREATE TABLE ACTION_TYPE ( 
	ID integer NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	LANG_KEY varchar(255)
)
;

CREATE TABLE ADVANCED_CONFIGURATION ( 
	ID bigint NOT NULL,
	ACCOUNT_ID bigint NOT NULL,
	REGISTER_PUBLISHERS boolean NOT NULL,
	CREATE_CATEGORY boolean NOT NULL,
	CREATE_LOCATIONS boolean NOT NULL,
	MAX_LOCATIONS integer NOT NULL,
	CONTRACT_ID bigint
)
;

CREATE TABLE BLOCK ( 
	ID bigint NOT NULL,
	ZONE_NUMBER integer,
	BLOCK_NUMBER integer,
	LOCATION_GEOM GEOMETRY NOT NULL
)
;

CREATE TABLE CATEGORY ( 
	ID bigint NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	STATUS_ID integer NOT NULL,
	LEVEL integer NOT NULL,
	IS_LEAF boolean NOT NULL,
	PARENT_ID bigint,
	LAST_PUBLISHED_FLYER timestamp NOT NULL
)
;

CREATE TABLE CATEGORY_PUBLISHER ( 
	ID bigint NOT NULL,
	PUBLISHER_ID bigint NOT NULL,
	CATEGORY_ID bigint NOT NULL
)
;

CREATE TABLE CATEGORY_SUBSCRIPTION ( 
	ID bigint NOT NULL,
	CATEGORY_ID bigint NOT NULL,
	CONSUMER_ID bigint NOT NULL,
	STATUS_ID integer NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	MODIFICATION_DATE timestamp NOT NULL
)
;

CREATE TABLE CONSUMER ( 
	ID bigint NOT NULL,
	GENDER_ID integer NOT NULL,
	NAME varchar(255) NOT NULL,
	LAST_NAME varchar(255) NOT NULL,
	EMAIL varchar(255) NOT NULL,
	CLIENT_TOKEN varchar(255) NOT NULL,
	VERIFIED_ACCOUNT boolean NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	VERIFICATION_DATE timestamp,
	CELL_PHONE_MODEL varchar(255),
	OS_MOBILE_VER varchar(255)
)
;

CREATE TABLE CONSUMER_VERIFICATION ( 
	ID bigint NOT NULL,
	VERIFICATION_TOKEN varchar(50),
	CONSUMER_ID bigint NOT NULL,
	EXPIRATION_DATE timestamp NOT NULL,
	STATUS_ID integer NOT NULL
)
;

CREATE TABLE CONTRACT ( 
	ID bigint NOT NULL,
	LINCENSE_TYPE_ID integer NOT NULL,
	LICENSE_ACTIVATION_CODE varchar(255) NOT NULL,
	COST_OF_LICENSE timestamp NOT NULL,
	TOTAL_OF_MONTHS integer NOT NULL,
	IS_ACTIVE boolean NOT NULL,
	IS_EXPIRED boolean NOT NULL,
	BEGINS_SINCE timestamp NOT NULL,
	EXPIRATION_DATE timestamp NOT NULL,
	ACCOUNT_ID bigint NOT NULL
)
;

CREATE TABLE FAVORITE_FLYER ( 
	ID bigint NOT NULL,
	FLYER_ID bigint NOT NULL,
	CONSUMER_ID bigint NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	MODIFICATION_DATE timestamp NOT NULL,
	STATUS_ID integer NOT NULL
)
;

CREATE TABLE FLYER ( 
	ID bigint NOT NULL,
	CATEGORY_ID bigint NOT NULL,
	FLYER_STATUS_ID integer NOT NULL,
	PUBLISHER_ID bigint NOT NULL,
	PUBLICATION_DATE timestamp NOT NULL,
	EVENT_DATE timestamp NOT NULL,
	EXPIRATION_DATE timestamp NOT NULL,
	IMAGE_URL varchar(255) NOT NULL,
	TITLE varchar(255) NOT NULL,
	LOCATION_ID bigint NOT NULL
)
;

CREATE TABLE FLYER_LOG_ENTRY ( 
	ID bigint NOT NULL,
	CATEGORY_ID bigint,
	FLYER_ID bigint,
	CONSUMER_ID bigint NOT NULL,
	ACTION_TYPE_ID integer NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	GEO_LATITUDE double precision,
	GEO_LONGITUDE double precision
)
;

CREATE TABLE FLYER_STATUS ( 
	ID integer NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	LANG_KEY varchar(255)
)
;

CREATE TABLE LOCATION ( 
	ID bigint NOT NULL,
	ACCOUNT_ID bigint NOT NULL,
	NAME varchar(255) NOT NULL,
	LOCATION_GEOM GEOMETRY
)
;

CREATE TABLE PAVILION ( 
	ID bigint NOT NULL,
	NAME varchar(255) NOT NULL,
	LOCATION_GEOM GEOMETRY NOT NULL
)
;

CREATE TABLE ROLE_REGISTRATION ( 
	ID bigint NOT NULL,
	ADV_CONF_ID bigint NOT NULL,
	PUBLISHER_TYPE_ID integer NOT NULL,
	PRE_PAYED_REGISTRATIONS integer NOT NULL,
	CURRENT_REGISTRATIONS integer NOT NULL,
	MAX_REGISTRATIONS integer NOT NULL
)
;

CREATE TABLE ROLES ( 
	ID integer NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	LANG_KEY varchar(255)
)
;

CREATE TABLE STATUS ( 
	ID integer NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	LANG_KEY varchar(255)
)
;

CREATE TABLE USERS ( 
	ID bigint NOT NULL,
	USER_NAME varchar(255) NOT NULL,
	PASSWORD varchar(255) NOT NULL,
	EMAIL varchar(255) NOT NULL,
	STATUS_ID integer NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	EXPIRATION_DATE timestamp NOT NULL,
	ROLE_ID integer NOT NULL,
	ACCOUNT_ID bigint NOT NULL,
	DEFAULT_LOCATION_ID bigint
)
;


ALTER TABLE ACCOUNT ADD CONSTRAINT PK_ACCOUNT 
	PRIMARY KEY (ID)
;


ALTER TABLE ACCOUNT_TYPE ADD CONSTRAINT PK_ACCOUNT_TYPE 
	PRIMARY KEY (ID)
;


ALTER TABLE ACTION_TYPE ADD CONSTRAINT PK_ACTION_TYPE 
	PRIMARY KEY (ID)
;


ALTER TABLE ADVANCED_CONFIGURATION ADD CONSTRAINT PK_ADVANCED_CONFIGURATION 
	PRIMARY KEY (ID)
;


ALTER TABLE BLOCK ADD CONSTRAINT PK_BLOCK 
	PRIMARY KEY (ID)
;


ALTER TABLE CATEGORY ADD CONSTRAINT PK_CATEGORY 
	PRIMARY KEY (ID)
;


ALTER TABLE CATEGORY_PUBLISHER ADD CONSTRAINT PK_CATEGORY_PUBLISHER 
	PRIMARY KEY (ID)
;


ALTER TABLE CATEGORY_SUBSCRIPTION ADD CONSTRAINT PK_CATEGORY_SUBSCRIPTION 
	PRIMARY KEY (ID)
;


ALTER TABLE CONSUMER ADD CONSTRAINT PK_CONSUMER 
	PRIMARY KEY (ID)
;


ALTER TABLE CONSUMER_VERIFICATION ADD CONSTRAINT PK_CONSUMER_VERIFICATION 
	PRIMARY KEY (ID)
;


ALTER TABLE CONTRACT ADD CONSTRAINT PK_LICENSE 
	PRIMARY KEY (ID)
;


ALTER TABLE FAVORITE_FLYER ADD CONSTRAINT PK_FAVORITE_FLYER 
	PRIMARY KEY (ID)
;


ALTER TABLE FLYER ADD CONSTRAINT PK_FLYER 
	PRIMARY KEY (ID)
;


ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT PK_FLYER_LOG_ENTRY 
	PRIMARY KEY (ID)
;


ALTER TABLE FLYER_STATUS ADD CONSTRAINT PK_FLYER_STATUS 
	PRIMARY KEY (ID)
;


ALTER TABLE LOCATION ADD CONSTRAINT PK_PUBLISHER_LOCATION 
	PRIMARY KEY (ID)
;


ALTER TABLE PAVILION ADD CONSTRAINT PK_PAVILION 
	PRIMARY KEY (ID)
;


ALTER TABLE ROLE_REGISTRATION ADD CONSTRAINT PK_ROLE_REGISTRATION 
	PRIMARY KEY (ID)
;


ALTER TABLE ROLES ADD CONSTRAINT PK_ROLE 
	PRIMARY KEY (ID)
;


ALTER TABLE STATUS ADD CONSTRAINT PK_STATUS 
	PRIMARY KEY (ID)
;


ALTER TABLE USERS ADD CONSTRAINT PK_USER 
	PRIMARY KEY (ID)
;



ALTER TABLE ACCOUNT_TYPE
	ADD CONSTRAINT UQ_ACCOUNT_TYPE_ID UNIQUE (ID)
;
ALTER TABLE ACTION_TYPE
	ADD CONSTRAINT UQ_ACTION_TYPE_ID UNIQUE (ID)
;
ALTER TABLE ADVANCED_CONFIGURATION
	ADD CONSTRAINT UQ_ADVANCED_CONFIGURATION_ID UNIQUE (ID)
;
ALTER TABLE CATEGORY
	ADD CONSTRAINT UQ_CATEGORY_ID UNIQUE (ID)
;
ALTER TABLE CATEGORY_PUBLISHER
	ADD CONSTRAINT UQ_CATEGORY_PUBLISHER_ID UNIQUE (ID)
;
ALTER TABLE CATEGORY_SUBSCRIPTION
	ADD CONSTRAINT UQ_CATEGORY_SUBSCRIPTION_ID UNIQUE (ID)
;
ALTER TABLE CONSUMER
	ADD CONSTRAINT UQ_CONSUMER_ID UNIQUE (ID)
;
ALTER TABLE CONSUMER_VERIFICATION
	ADD CONSTRAINT UQ_CONSUMER_VERIFICATION_ID UNIQUE (ID)
;
ALTER TABLE CONTRACT
	ADD CONSTRAINT UQ_LICENSE_ID UNIQUE (ID)
;
ALTER TABLE FAVORITE_FLYER
	ADD CONSTRAINT UQ_FAVORITE_FLYER_ID UNIQUE (FLYER_ID)
;
ALTER TABLE FLYER
	ADD CONSTRAINT UQ_FLYER_ID UNIQUE (ID)
;
ALTER TABLE FLYER_LOG_ENTRY
	ADD CONSTRAINT UQ_FLYER_LOG_ENTRY_ID UNIQUE (ID)
;
ALTER TABLE FLYER_STATUS
	ADD CONSTRAINT UQ_FLYER_STATUS_ID UNIQUE (ID)
;
ALTER TABLE LOCATION
	ADD CONSTRAINT UQ_PUBLISHER_LOCATION_ID UNIQUE (ID)
;
ALTER TABLE ROLE_REGISTRATION
	ADD CONSTRAINT UQ_ROLE_REGISTRATION_ID UNIQUE (ID)
;
ALTER TABLE ROLES
	ADD CONSTRAINT UQ_ROLE_ID UNIQUE (ID)
;
ALTER TABLE STATUS
	ADD CONSTRAINT UQ_STATUS_ID UNIQUE (ID)
;
ALTER TABLE USERS
	ADD CONSTRAINT UQ_USER_ID UNIQUE (ID)
;

ALTER TABLE ACCOUNT ADD CONSTRAINT FK_ACCOUNT_ACCOUNT_TYPE 
	FOREIGN KEY (ACCOUNT_TYPE_ID) REFERENCES ACCOUNT_TYPE (ID)
;

ALTER TABLE ACCOUNT ADD CONSTRAINT FK_COMPANY_STATUS 
	FOREIGN KEY (STATUS_ID) REFERENCES STATUS (ID)
;

ALTER TABLE ADVANCED_CONFIGURATION ADD CONSTRAINT FK_ADVANCED_CONFIGURATION_ACCOUNT 
	FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT (ID)
;

ALTER TABLE ADVANCED_CONFIGURATION ADD CONSTRAINT FK_ADVANCED_CONFIGURATION_CONTRACT 
	FOREIGN KEY (CONTRACT_ID) REFERENCES CONTRACT (ID)
;

ALTER TABLE CATEGORY ADD CONSTRAINT FK_CATEGORY_CATEGORY 
	FOREIGN KEY (PARENT_ID) REFERENCES CATEGORY (ID)
;

ALTER TABLE CATEGORY_PUBLISHER ADD CONSTRAINT FK_CATEGORY_PUBLISHER_USERS 
	FOREIGN KEY (PUBLISHER_ID) REFERENCES USERS (ID)
;

ALTER TABLE CATEGORY_PUBLISHER ADD CONSTRAINT FK_CP_CATEGORY 
	FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY (ID)
;

ALTER TABLE CATEGORY_SUBSCRIPTION ADD CONSTRAINT FK_CATEGORY_SUBSCRIPTION_CONSUMER 
	FOREIGN KEY (CONSUMER_ID) REFERENCES CONSUMER (ID)
;

ALTER TABLE CATEGORY_SUBSCRIPTION ADD CONSTRAINT FK_CATEGORY_SUBSCRIPTION_STATUS 
	FOREIGN KEY (STATUS_ID) REFERENCES STATUS (ID)
;

ALTER TABLE CONSUMER_VERIFICATION ADD CONSTRAINT FK_CONSUMER_VERIFICATION_CONSUMER 
	FOREIGN KEY (CONSUMER_ID) REFERENCES CONSUMER (ID)
;

ALTER TABLE CONSUMER_VERIFICATION ADD CONSTRAINT FK_CONSUMER_VERIFICATION_STATUS 
	FOREIGN KEY (STATUS_ID) REFERENCES STATUS (ID)
;

ALTER TABLE CONTRACT ADD CONSTRAINT FK_CONTRACT_ACCOUNT 
	FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT (ID)
;

ALTER TABLE FAVORITE_FLYER ADD CONSTRAINT FK_FAVORITE_FLYER_CONSUMER 
	FOREIGN KEY (CONSUMER_ID) REFERENCES CONSUMER (ID)
;

ALTER TABLE FAVORITE_FLYER ADD CONSTRAINT FK_FAVORITE_FLYER_FLYER 
	FOREIGN KEY (FLYER_ID) REFERENCES FLYER (ID)
;

ALTER TABLE FAVORITE_FLYER ADD CONSTRAINT FK_FF_STATUS 
	FOREIGN KEY (STATUS_ID) REFERENCES STATUS (ID)
;

ALTER TABLE FLYER ADD CONSTRAINT FK_FLYER_USERS 
	FOREIGN KEY (PUBLISHER_ID) REFERENCES USERS (ID)
;

ALTER TABLE FLYER ADD CONSTRAINT FK_FLYER_CATEGORY 
	FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY (ID)
;

ALTER TABLE FLYER ADD CONSTRAINT FK_FLYER_FLYER_STATUS 
	FOREIGN KEY (FLYER_STATUS_ID) REFERENCES FLYER_STATUS (ID)
;

ALTER TABLE FLYER ADD CONSTRAINT FK_FLYER_LOCATION 
	FOREIGN KEY (LOCATION_ID) REFERENCES LOCATION (ID)
;

ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT FK_FLYER_LOG_ENTRY_ACTION_TYPE 
	FOREIGN KEY (ACTION_TYPE_ID) REFERENCES ACTION_TYPE (ID)
;

ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT FK_FLYER_LOG_ENTRY_CATEGORY 
	FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY (ID)
;

ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT FK_FLYER_LOG_ENTRY_CONSUMER 
	FOREIGN KEY (CONSUMER_ID) REFERENCES CONSUMER (ID)
;

ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT FK_FLYER_LOG_ENTRY_FLYER 
	FOREIGN KEY (FLYER_ID) REFERENCES FLYER (ID)
;

ALTER TABLE LOCATION ADD CONSTRAINT FK_LOCATION_ACCOUNT 
	FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT (ID)
;

ALTER TABLE ROLE_REGISTRATION ADD CONSTRAINT FK_ROLE_REGISTRATION_ADVANCED_CONFIGURATION 
	FOREIGN KEY (ADV_CONF_ID) REFERENCES ADVANCED_CONFIGURATION (ID)
;

ALTER TABLE ROLE_REGISTRATION ADD CONSTRAINT FK_ROLE_REGISTRATION_ROLES 
	FOREIGN KEY (PUBLISHER_TYPE_ID) REFERENCES ROLES (ID)
;

ALTER TABLE USERS ADD CONSTRAINT FK_USERS_ACCOUNT 
	FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT (ID)
;

ALTER TABLE USERS ADD CONSTRAINT FK_USERS_LOCATION 
	FOREIGN KEY (DEFAULT_LOCATION_ID) REFERENCES LOCATION (ID)
;

ALTER TABLE USERS ADD CONSTRAINT FK_USER_ROLE 
	FOREIGN KEY (ROLE_ID) REFERENCES ROLES (ID)
;

ALTER TABLE USERS ADD CONSTRAINT FK_USER_STATUS 
	FOREIGN KEY (STATUS_ID) REFERENCES STATUS (ID)
;


CREATE TABLE LINK_ACTION ( 
	ID integer NOT NULL,
	NAME varchar(255) NOT NULL
)
;

CREATE TABLE LINK_HASH ( 
	ID bigint NOT NULL,
	TOKEN varchar(255) NOT NULL,
	LINK_ACTION_ID integer NOT NULL,
	CREATION_DATE timestamp NOT NULL,
	USER_ID bigint
)
;


ALTER TABLE LINK_ACTION ADD CONSTRAINT PK_LINK_ACTION 
	PRIMARY KEY (ID)
;

ALTER TABLE LINK_HASH ADD CONSTRAINT PK_LINK_HASH 
	PRIMARY KEY (ID)
;

ALTER TABLE LINK_ACTION
	ADD CONSTRAINT UQ_LINK_ACTION_ID UNIQUE (ID)
;
ALTER TABLE LINK_HASH
	ADD CONSTRAINT UQ_LINK_HASH_ID UNIQUE (ID)
;

ALTER TABLE LINK_HASH ADD CONSTRAINT FK_LINK_HASH_LINK_ACTION 
	FOREIGN KEY (LINK_ACTION_ID) REFERENCES LINK_ACTION (ID)
;

ALTER TABLE LINK_HASH ADD CONSTRAINT FK_LINK_HASH_USERS 
	FOREIGN KEY (USER_ID) REFERENCES USERS (ID)
;


-- Sequences
DROP SEQUENCE ACCOUNT_SEQ;
DROP SEQUENCE ADV_CONFIGURATION_SEQ;
DROP SEQUENCE CATEGORY_SEQ;
DROP SEQUENCE CATEGORY_PUBLISHER_SEQ;
DROP SEQUENCE CATEGORY_SUBSCRIPTION_SEQ;
DROP SEQUENCE CONSUMER_SEQ;
DROP SEQUENCE CONSUMER_VERIFICATION_SEQ;
DROP SEQUENCE CONTRACT_SEQ;
DROP SEQUENCE FAVORITE_FLYER_SEQ;
DROP SEQUENCE FLYER_SEQ;
DROP SEQUENCE FLYER_LOG_ENTRY_SEQ;
DROP SEQUENCE LOCATION_SEQ;
DROP SEQUENCE ROLE_REGISTRATION_SEQ;
DROP SEQUENCE USERS_SEQ;
DROP SEQUENCE LINK_HASH_SEQ;

CREATE SEQUENCE ACCOUNT_SEQ START 100;
CREATE SEQUENCE ADV_CONFIGURATION_SEQ START 100;
CREATE SEQUENCE CATEGORY_SEQ START 100;
CREATE SEQUENCE CATEGORY_PUBLISHER_SEQ START 100;
CREATE SEQUENCE CATEGORY_SUBSCRIPTION_SEQ START 100;
CREATE SEQUENCE CONSUMER_SEQ START 100;
CREATE SEQUENCE CONSUMER_VERIFICATION_SEQ START 100;
CREATE SEQUENCE CONTRACT_SEQ START 100;
CREATE SEQUENCE FAVORITE_FLYER_SEQ START 100;
CREATE SEQUENCE FLYER_SEQ START 100;
CREATE SEQUENCE FLYER_LOG_ENTRY_SEQ START 100;
CREATE SEQUENCE LOCATION_SEQ START 100;
CREATE SEQUENCE ROLE_REGISTRATION_SEQ START 100;
CREATE SEQUENCE USERS_SEQ START 100;
CREATE SEQUENCE LINK_HASH_SEQ START 100;

