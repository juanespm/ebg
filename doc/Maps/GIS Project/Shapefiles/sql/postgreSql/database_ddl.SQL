DROP TABLE ACTION_TYPE
;
DROP TABLE ADVANCED_CONFIGURATION
;
DROP TABLE CATEGORY
;
DROP TABLE CATEGORY_PUBLISHER
;
DROP TABLE CATEGORY_SUBSCRIPTION
;
DROP TABLE CONSUMER
;
DROP TABLE CONSUMER_VERIFICATION
;
DROP TABLE FAVORITE_FLYER
;
DROP TABLE FLYER
;
DROP TABLE FLYER_LOG_ENTRY
;
DROP TABLE FLYER_STATUS
;
DROP TABLE PUBLISHER
;
DROP TABLE PUBLISHER_TYPE
;
DROP TABLE ROLE_REGISTRATION
;
DROP TABLE ROLES
;
DROP TABLE STATUS
;
DROP TABLE USERS
;



CREATE TABLE ACTION_TYPE ( 
	ID integer NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	LANG_KEY varchar(255)
)
;

CREATE TABLE ADVANCED_CONFIGURATION ( 
	ID bigint NOT NULL,
	ACTIVATION_DAY timestamp NOT NULL,
	EXPIRATION_DATE timestamp NOT NULL,
	REGISTER_PUBLISHERS boolean NOT NULL,
	CREATE_CATEGORY boolean NOT NULL
)
;

CREATE TABLE CATEGORY ( 
	ID bigint NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	STATUS_ID integer NOT NULL,
	LEVEL integer NOT NULL,
	IS_LEAF boolean NOT NULL,
	PARENT_ID bigint
)
;

CREATE TABLE CATEGORY_PUBLISHER ( 
	ID bigint NOT NULL,
	PUBLISHER_ID bigint NOT NULL,
	CATEGORY_ID bigint NOT NULL
)
;

CREATE TABLE CATEGORY_SUBSCRIPTION ( 
	ID bigint NOT NULL,
	CATEGORY_ID bigint NOT NULL,
	CONSUMER_ID bigint NOT NULL,
	STATUS_ID integer NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	MODIFICATION_DATE timestamp NOT NULL
)
;

CREATE TABLE CONSUMER ( 
	ID bigint NOT NULL,
	GENDER_ID integer NOT NULL,
	NAME varchar(255) NOT NULL,
	LAST_NAME varchar(255) NOT NULL,
	EMAIL varchar(255) NOT NULL,
	CLIENT_TOKEN varchar(255) NOT NULL,
	VERIFIED_ACCOUNT boolean NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	VERIFICATION_DATE timestamp,
	CELL_PHONE_MODEL varchar(255),
	OS_MOBILE_VER varchar(255)
)
;

CREATE TABLE CONSUMER_VERIFICATION ( 
	ID bigint NOT NULL,
	VERIFICATION_TOKEN varchar(50),
	CONSUMER_ID bigint NOT NULL,
	EXPIRATION_DATE timestamp NOT NULL,
	STATUS_ID integer NOT NULL
)
;

CREATE TABLE FAVORITE_FLYER ( 
	ID bigint NOT NULL,
	FLYER_ID bigint NOT NULL,
	CONSUMER_ID bigint NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	MODIFICATION_DATE timestamp NOT NULL,
	STATUS_ID integer NOT NULL
)
;

CREATE TABLE FLYER ( 
	ID bigint NOT NULL,
	CATEGORY_ID bigint NOT NULL,
	FLYER_STATUS_ID integer NOT NULL,
	PUBLISHER_ID bigint NOT NULL,
	PUBLICATION_DATE timestamp NOT NULL,
	EVENT_DATE timestamp NOT NULL,
	EXPIRATION_DATE timestamp NOT NULL,
	IMAGE_URL varchar(255) NOT NULL,
	TITLE varchar(255) NOT NULL
)
;

CREATE TABLE FLYER_LOG_ENTRY ( 
	ID bigint NOT NULL,
	CATEGORY_ID bigint,
	FLYER_ID bigint,
	CONSUMER_ID bigint NOT NULL,
	ACTION_TYPE_ID integer NOT NULL,
	REGISTRATION_DATE timestamp NOT NULL,
	GEO_LATITUDE double precision,
	GEO_LONGITUDE double precision
)
;

CREATE TABLE FLYER_STATUS ( 
	ID integer NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	LANG_KEY varchar(255)
)
;

CREATE TABLE PUBLISHER ( 
	ID bigint NOT NULL,
	PUBLISHER_NAME varchar(255) NOT NULL,
	PUBLISHER_TYPE_ID integer NOT NULL,
	PUBLISHER_EMAIL varchar(255),
	STATUS_ID integer NOT NULL,
	WEB_SITE varchar(255),
	REGISTRATION_DATE timestamp NOT NULL,
	EXPIRATION_DATE timestamp NOT NULL,
	DEFAULT_LOCATION_ID bigint
)
;

CREATE TABLE PUBLISHER_LOCATION ( 
	ID bigint NOT NULL,
	PUBLISHER_ID bigint NOT NULL,
	NAME varchar(255) NOT NULL,
	LOCATION_GEOM GEOMETRY NOT NULL
)
;

CREATE TABLE PUBLISHER_TYPE ( 
	ID integer NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	LANG_KEY varchar(255)
)
;

CREATE TABLE ROLE_REGISTRATION ( 
	ID bigint NOT NULL,
	ADV_CONF_ID bigint NOT NULL,
	PUBLISHER_TYPE_ID integer NOT NULL,
	CURRENT_REGISTRATIONS bigint NOT NULL,
	MAX_REGISTRATIONS bigint NOT NULL
)
;

CREATE TABLE ROLES ( 
	ID integer NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	LANG_KEY varchar(255)
)
;

CREATE TABLE STATUS ( 
	ID integer NOT NULL,
	NAME varchar(70) NOT NULL,
	DESCRIPTION varchar(255),
	LANG_KEY varchar(255)
)
;

CREATE TABLE USERS ( 
	ID bigint NOT NULL,
	USER_NAME varchar(255) NOT NULL,
	PASSWORD varchar(255) NOT NULL,
	EMAIL varchar(255) NOT NULL,
	STATUS_ID integer NOT NULL,
	PUBLISHER_ID bigint,
	ADV_CONF_ID bigint,
	REGISTRATION_DATE timestamp NOT NULL,
	EXPIRATION_DATE timestamp NOT NULL,
	ROLE_ID integer NOT NULL
)
;

CREATE TABLE BLOCK ( 
	ID bigint NOT NULL,
	ZONE_NUMBER integer,
	BLOCK_NUMBER integer,
	LOCATION_GEOM GEOMETRY NOT NULL
)
;

CREATE TABLE PAVILION ( 
	ID bigint NOT NULL,
	NAME varchar(255) NOT NULL,
	LOCATION_GEOM GEOMETRY NOT NULL
)
;


ALTER TABLE BLOCK ADD CONSTRAINT PK_BLOCK 
	PRIMARY KEY (ID)
;


ALTER TABLE PAVILION ADD CONSTRAINT PK_PAVILION 
	PRIMARY KEY (ID)
;



ALTER TABLE ACTION_TYPE ADD CONSTRAINT PK_ACTION_TYPE 
	PRIMARY KEY (ID)
;


ALTER TABLE ADVANCED_CONFIGURATION ADD CONSTRAINT PK_ADVANCED_CONFIGURATION 
	PRIMARY KEY (ID)
;


ALTER TABLE CATEGORY ADD CONSTRAINT PK_CATEGORY 
	PRIMARY KEY (ID)
;


ALTER TABLE CATEGORY_PUBLISHER ADD CONSTRAINT PK_CATEGORY_PUBLISHER 
	PRIMARY KEY (ID)
;


ALTER TABLE CATEGORY_SUBSCRIPTION ADD CONSTRAINT PK_CATEGORY_SUBSCRIPTION 
	PRIMARY KEY (ID)
;


ALTER TABLE CONSUMER ADD CONSTRAINT PK_CONSUMER 
	PRIMARY KEY (ID)
;


ALTER TABLE CONSUMER_VERIFICATION ADD CONSTRAINT PK_CONSUMER_VERIFICATION 
	PRIMARY KEY (ID)
;


ALTER TABLE FAVORITE_FLYER ADD CONSTRAINT PK_FAVORITE_FLYER 
	PRIMARY KEY (FLYER_ID)
;


ALTER TABLE FLYER ADD CONSTRAINT PK_FLYER 
	PRIMARY KEY (ID)
;


ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT PK_FLYER_LOG_ENTRY 
	PRIMARY KEY (ID)
;


ALTER TABLE FLYER_STATUS ADD CONSTRAINT PK_FLYER_STATUS 
	PRIMARY KEY (ID)
;


ALTER TABLE PUBLISHER ADD CONSTRAINT PK_PUBLISHER 
	PRIMARY KEY (ID)
;

ALTER TABLE PUBLISHER
	ADD CONSTRAINT UQ_PUBLISHER_ID UNIQUE (ID)
;


ALTER TABLE PUBLISHER_LOCATION ADD CONSTRAINT PK_PUBLISHER_LOCATION 
	PRIMARY KEY (ID)
;

ALTER TABLE PUBLISHER_LOCATION
	ADD CONSTRAINT UQ_PUBLISHER_LOCATION_ID UNIQUE (ID)
;


ALTER TABLE PUBLISHER_TYPE ADD CONSTRAINT PK_PUBLICATION_POLICY 
	PRIMARY KEY (ID)
;


ALTER TABLE ROLE_REGISTRATION ADD CONSTRAINT PK_ROLE_REGISTRATION 
	PRIMARY KEY (ID)
;


ALTER TABLE ROLES ADD CONSTRAINT PK_ROLE 
	PRIMARY KEY (ID)
;


ALTER TABLE STATUS ADD CONSTRAINT PK_STATUS 
	PRIMARY KEY (ID)
;


ALTER TABLE USERS ADD CONSTRAINT PK_USER 
	PRIMARY KEY (ID)
;

ALTER TABLE CATEGORY ADD CONSTRAINT FK_CATEGORY_CATEGORY 
	FOREIGN KEY (PARENT_ID) REFERENCES CATEGORY (ID)
;

ALTER TABLE CATEGORY_PUBLISHER ADD CONSTRAINT FK_CP_CATEGORY 
	FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY (ID)
;

ALTER TABLE CATEGORY_PUBLISHER ADD CONSTRAINT FK_CP_PUBLISHER 
	FOREIGN KEY (PUBLISHER_ID) REFERENCES PUBLISHER (ID)
;

ALTER TABLE CATEGORY_SUBSCRIPTION ADD CONSTRAINT FK_CATEGORY_SUBSCRIPTION_CONSUMER 
	FOREIGN KEY (CONSUMER_ID) REFERENCES CONSUMER (ID)
;

ALTER TABLE CATEGORY_SUBSCRIPTION ADD CONSTRAINT FK_CATEGORY_SUBSCRIPTION_STATUS 
	FOREIGN KEY (STATUS_ID) REFERENCES STATUS (ID)
;

ALTER TABLE CONSUMER_VERIFICATION ADD CONSTRAINT FK_CONSUMER_VERIFICATION_CONSUMER 
	FOREIGN KEY (CONSUMER_ID) REFERENCES CONSUMER (ID)
;

ALTER TABLE CONSUMER_VERIFICATION ADD CONSTRAINT FK_CONSUMER_VERIFICATION_STATUS 
	FOREIGN KEY (STATUS_ID) REFERENCES STATUS (ID)
;

ALTER TABLE FAVORITE_FLYER ADD CONSTRAINT FK_FAVORITE_FLYER_CONSUMER 
	FOREIGN KEY (CONSUMER_ID) REFERENCES CONSUMER (ID)
;

ALTER TABLE FAVORITE_FLYER ADD CONSTRAINT FK_FAVORITE_FLYER_FLYER 
	FOREIGN KEY (FLYER_ID) REFERENCES FLYER (ID)
;

ALTER TABLE FAVORITE_FLYER ADD CONSTRAINT FK_FF_STATUS 
	FOREIGN KEY (STATUS_ID) REFERENCES STATUS (ID)
;

ALTER TABLE FLYER ADD CONSTRAINT FK_FLYER_CATEGORY 
	FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY (ID)
;

ALTER TABLE FLYER ADD CONSTRAINT FK_FLYER_FLYER_STATUS 
	FOREIGN KEY (FLYER_STATUS_ID) REFERENCES FLYER_STATUS (ID)
;

ALTER TABLE FLYER ADD CONSTRAINT FK_FLYER_PUBLISHER 
	FOREIGN KEY (PUBLISHER_ID) REFERENCES PUBLISHER (ID)
;

ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT FK_FLYER_LOG_ENTRY_ACTION_TYPE 
	FOREIGN KEY (ACTION_TYPE_ID) REFERENCES ACTION_TYPE (ID)
;

ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT FK_FLYER_LOG_ENTRY_CATEGORY 
	FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY (ID)
;

ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT FK_FLYER_LOG_ENTRY_CONSUMER 
	FOREIGN KEY (CONSUMER_ID) REFERENCES CONSUMER (ID)
;

ALTER TABLE FLYER_LOG_ENTRY ADD CONSTRAINT FK_FLYER_LOG_ENTRY_FLYER 
	FOREIGN KEY (FLYER_ID) REFERENCES FLYER (ID)
;

ALTER TABLE PUBLISHER ADD CONSTRAINT FK_PUBLISHER_PUBLISHER_TYPE 
	FOREIGN KEY (PUBLISHER_TYPE_ID) REFERENCES PUBLISHER_TYPE (ID)
;

ALTER TABLE PUBLISHER ADD CONSTRAINT FK_DEFAULT_LOCATION 
	FOREIGN KEY (DEFAULT_LOCATION_ID) REFERENCES PUBLISHER_LOCATION (ID)
;

ALTER TABLE PUBLISHER ADD CONSTRAINT FK_PUBLISHER_PUBLISHER_TYPE 
	FOREIGN KEY (PUBLISHER_TYPE_ID) REFERENCES PUBLISHER_TYPE (ID)
;

ALTER TABLE PUBLISHER_LOCATION ADD CONSTRAINT FK_PUBLISHER_LOC 
	FOREIGN KEY (PUBLISHER_ID) REFERENCES PUBLISHER (ID)
;

ALTER TABLE ROLE_REGISTRATION ADD CONSTRAINT FK_ROLE_REGISTRATION_PUBLISHER_TYPE 
	FOREIGN KEY (PUBLISHER_TYPE_ID) REFERENCES PUBLISHER_TYPE (ID)
;

ALTER TABLE USERS ADD CONSTRAINT FK_USER_ADVANCED_CONFIGURATION 
	FOREIGN KEY (ADV_CONF_ID) REFERENCES ADVANCED_CONFIGURATION (ID)
;

ALTER TABLE USERS ADD CONSTRAINT FK_USER_PUBLISHER 
	FOREIGN KEY (PUBLISHER_ID) REFERENCES PUBLISHER (ID)
;

ALTER TABLE USERS ADD CONSTRAINT FK_USER_ROLE 
	FOREIGN KEY (ROLE_ID) REFERENCES ROLES (ID)
;

ALTER TABLE USERS ADD CONSTRAINT FK_USER_STATUS 
	FOREIGN KEY (STATUS_ID) REFERENCES STATUS (ID)
;

-- Sequences
DROP SEQUENCE ADV_CONFIGURATION_SEQ;
DROP SEQUENCE CATEGORY;
DROP SEQUENCE CATEGORY_PUBLISHER_SEQ;
DROP SEQUENCE CATEGORY_SUBSCRIPTION_SEQ;
DROP SEQUENCE CONSUMER_SEQ;
DROP SEQUENCE CONSUMER_VERIFICATION_SEQ;
DROP SEQUENCE FAVORITE_FLYER_SEQ;
DROP SEQUENCE FLYER_SEQ;
DROP SEQUENCE FLYER_LOG_ENTRY_SEQ;
DROP SEQUENCE PUBLISHER_SEQ;
DROP SEQUENCE PUBLISHER_LOC_SEQ;
DROP SEQUENCE ROLE_REGISTRATION_SEQ;
DROP SEQUENCE USERS_SEQ;


CREATE SEQUENCE ADV_CONFIGURATION_SEQ START 1;
CREATE SEQUENCE CATEGORY START 1;
CREATE SEQUENCE CATEGORY_PUBLISHER_SEQ START 1;
CREATE SEQUENCE CATEGORY_SUBSCRIPTION_SEQ START 1;
CREATE SEQUENCE CONSUMER_SEQ START 1;
CREATE SEQUENCE CONSUMER_VERIFICATION_SEQ START 1;
CREATE SEQUENCE FAVORITE_FLYER_SEQ START 1;
CREATE SEQUENCE FLYER_SEQ START 1;
CREATE SEQUENCE FLYER_LOG_ENTRY_SEQ START 1;
CREATE SEQUENCE PUBLISHER_SEQ START 1;
CREATE SEQUENCE PUBLISHER_LOC_SEQ START 1;
CREATE SEQUENCE ROLE_REGISTRATION_SEQ START 1;
CREATE SEQUENCE USERS_SEQ START 1;
